<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I am Composer</title>
</head>

<body>
    <div class="canvas-container">
        <canvas id="canvasElement">
        </canvas>
        <div class="score-container">
            <div id="score">

            </div>
            <button onclick="playScore()">play</button>
            <button onclick="cleanScore()">clean</button>
        </div>
    </div>
    <div class="piano">
        <ul id="all">
            <li>do</li>
            <li>re</li>
            <li>me</li>
            <li>fa</li>
            <li>so</li>
            <li>la</li>
            <li>xi</li>
        </ul>
    </div>
    <div class="visual-container">
        <div class="inner-container">
            <div class="visualization do"></div>
            <div class="visualization do" id="do"></div>
            <div class="visualization do"></div>
            <div class="visualization re"></div>
            <div class="visualization re" id="re"></div>
            <div class="visualization re"></div>
            <div class="visualization me"></div>
            <div class="visualization me" id="me"></div>
            <div class="visualization me"></div>
            <div class="visualization fa"></div>
            <div class="visualization fa" id="fa"></div>
            <div class="visualization fa"></div>
            <div class="visualization so"></div>
            <div class="visualization so" id="so"></div>
            <div class="visualization so"></div>
            <div class="visualization la"></div>
            <div class="visualization la" id="la"></div>
            <div class="visualization la"></div>
            <div class="visualization xi"></div>
            <div class="visualization xi" id="xi"></div>
            <div class="visualization xi"></div>
        </div>
    </div>
</body>

<script type="text/javascript" src="./js/jquery.min.js"></script>
<script type="text/javascript" src="./js/main.js"></script>
<script>
    //鼠标按下事件
    $('li').mousedown(function () {
        play($(this).html().toLowerCase());
        addRecord($(this).html().toLowerCase());
    });
</script>

<script>
    function play(note) {
        let src = "./assets/" + note + '.mp3';
        let audio = new Audio(src);
        let list = ['do', 're', 'me', 'fa', 'so', 'la', 'xi'];
        let index = list.indexOf(note);
        // document.getElementsByClassName("box")[index].style.height = "100px";
        $("#" + note).height(100);
        let noteList = document.getElementsByClassName(note);
        $("." + note + ":first").height(100 * Math.random());
        $("." + note + ":eq(2)").height(100 * Math.random());
        audio.play();
        setTimeout(() => {
            // document.getElementsByClassName("box")[index].style.height = "5px";
            $("." + note).height(5);
            let noteList = document.getElementsByClassName(note);
        }, 300);
    }
</script>

<script>
    var record = [];
    function addRecord(note) {
        let list = ['do', 're', 'me', 'fa', 'so', 'la', 'xi'];
        record.push(list.indexOf(note) + 1);
        let text = "";
        for (let i = 0; i < record.length; i++) {
            text += record[i] + " ";
        }
        document.getElementById("score").innerHTML = text;
    }

    async function playScore() {
        for (let i = 0; i < record.length; i++) {
            let list = ['do', 're', 'me', 'fa', 'so', 'la', 'xi'];
            play(list[record[i] - 1]);
            await sleep(300);
        }
    }

    function sleep(time) {
        return new Promise((resolve) => setTimeout(resolve, time));
    }

    function cleanScore() {
        record = [];
        document.getElementById("score").innerHTML = "";
    }
</script>

<style>
    .canvas-container {
        display: flex;
        width: 449;
        height: 449;
        flex-grow: 0;
        flex-direction: row;
        justify-content: space-around;
    }

    li {
        width: 100px;
        height: 100%;
        background: #fff;
        float: left;
        border-right: solid 2px black;
        border-radius: 0px 0px 10px 10px;
        text-align: center;
        line-height: 35em;
        margin: 0px;
        padding: 0px;
    }

    #all {
        border: solid 0px #333;
        margin: 100px auto;
    }

    .visualization {
        height: 5px;
        border-radius: 2px;
        width: 50px;
        transition: 0.8s ease-out;
        margin: 1px;
        background: #ff6e7f;
        /* fallback for old browsers */
        background: linear-gradient(to top, #ff6e7f, #bfe9ff);
        /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */


    }

    /* #do {
        background: linear-gradient(to right, #c0c0aa, #b1c5b2);
    }

    #re {
        background: linear-gradient(to right, #b1c5b2, #9accbf);
    }

    #me {
        background: linear-gradient(to right, #9accbf, #82d2cb);
    }

    #fa {
        background: linear-gradient(to right, #82d2cb, #6ed7d4);
    }

    #so {
        background: linear-gradient(to right, #6ed7d4, #5adddf);
    }

    #la {
        background: linear-gradient(to right, #5adddf, #44e3ea);
    }

    #xi {
        background: linear-gradient(to right, #44e3ea, #1cefff);
    } */

    .piano {
        display: flex;
    }

    .visual-container {
        display: flex;
        height: 100px;
        flex-direction: column-reverse;
        align-items: center;
    }

    .inner-container {
        display: flex;
        flex-direction: row;
        height: 100px;
        align-items: flex-end;
    }

    #score {
        border: solid 1px black;
        width: 300px;
        height: 300px;
    }
</style>

</html>